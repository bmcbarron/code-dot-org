#!/usr/bin/env ruby

# This class processes and uploads a video to s3,
# making it available for viewing through Code.org's fallback video player.

# Usage:
# upload-video [video filename] [youtube id]
#
# Dependency requirements:
#
# ffmpeg (`brew install ffmpeg` / `apt-get install ffmpeg`) - for transcoding the video
# s3_access_key_id and s3_secret_access_key defined (e.g. in `locals.yml`)

require_relative '../deployment'

require 'cdo/aws/s3'
require 'tmpdir'
require 'open-uri'
require 'cdo/video/youtube'

VIDEO_BUCKET = 'videos.code.org'

def usage
  puts 'Usage: upload-video [video filename] [youtube id]'
end

def main
  if ARGV.length < 2
    return usage
  end
  filename = ARGV[0]
  id = ARGV[1]
  if filename.nil? || id.nil?
    return usage
  end
  Youtube.process(id, filename)
end

main
